---
title: "Wiederholungen in landwirtschaftlichen Feldversuchen"
subtitle: "Grundsatzvortrag"
author: "Dr. Paul Schmidt"
format:
  revealjs:
    theme: default
    css: custom.css
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: "On-farm-Experimente-Workshop | 28.11.2024 | Landwirtschaftskammer Niedersachsen"
    transition: slide
    background-transition: fade
  pdf:
    documentclass: beamer
    theme: default
---

```{r setup}
#| include: false

library(ggplot2)
library(desplot)
library(ggtext)

# Setze globale Farbpalette f√ºr alle ggplot2/desplot Grafiken
options(ggplot2.discrete.fill = c("#00923f", "#bce2cc", "#4758ab", "#ad0000", "#cba135"))
options(ggplot2.discrete.colour = c("#00923f", "#bce2cc", "#4758ab", "#ad0000", "#cba135"))

# BioMath Theme Definition
theme_BioMath <- function(base_size = 11,
                          base_family = "",
                          base_color = "#001509",
                          axis_title_bold = FALSE,
                          axis_title_just = "rt",
                          ticks = FALSE,
                          grid_x = FALSE,
                          grid_y = FALSE,
                          grid_color = "#C0BCB5",
                          grid_linetype = "dotted",
                          facette_distance = 1,
                          facette_box = FALSE,
                          facette_box_color = "#C0BCB5",
                          title_size = 14,
                          subtitle_size = 10,
                          axistext_size = 10,
                          ggtext_axis = TRUE,
                          whitebg = TRUE,
                          ...) {

  tBM <- ggplot2::theme_minimal(base_family = base_family, base_size = base_size, ...)
  tBM <- tBM + theme(legend.background = element_blank())
  tBM <- tBM + theme(legend.key = element_blank())
  tBM <- tBM + theme(panel.grid=element_blank())

  if (grid_x) {
    tBM <- tBM +
      theme(panel.grid.major.x = element_line(
        linewidth = 0.2,
        color = grid_color,
        linetype = grid_linetype
      ))
  }

  if (grid_y) {
    tBM <- tBM +
      theme(panel.grid.major.y = element_line(
        linewidth = 0.2,
        color = grid_color,
        linetype = grid_linetype
      ))
  }

  if (facette_box) {
    tBM <- tBM +
      theme(
        panel.border = element_rect(fill = NA, colour = facette_box_color),
        strip.background = element_rect(fill = NA, colour = NA),
        strip.text.x = ggtext::element_textbox(size = base_size, color = facette_box_color),
        strip.text.y = ggtext::element_textbox(size = base_size, color = facette_box_color),
      )
  }

  tBM <- tBM +
    theme(
      panel.spacing = unit(facette_distance, "lines"),
      plot.margin = margin(3,3,3,3)
    )

  tBM <- tBM +
    theme(
      strip.text.x = ggtext::element_textbox(
        hjust = 0,
        size = base_size,
        color = facette_box_color
      ),
      strip.text.y = ggtext::element_textbox(
        hjust = 0,
        size = base_size,
        color = facette_box_color,
        orientation = "right-rotated"
      ),
      panel.border = element_rect(fill = NA, colour = NA),
      strip.background = element_rect(fill = NA, colour = NA)
    )

  if (facette_box) {
    tBM <- tBM +
      theme(panel.border = element_rect(fill = NA, colour = facette_box_color))
  }

  tBM <- tBM + theme(axis.line=element_line(color=base_color, linewidth=0.15))

  if (ticks) {
    tBM <- tBM + theme(axis.ticks = element_line(linewidth=0.15))
    tBM <- tBM + theme(axis.ticks.x = element_line(linewidth=0.15))
    tBM <- tBM + theme(axis.ticks.y = element_line(linewidth=0.15))
    tBM <- tBM + theme(axis.ticks.length = grid::unit(3, "pt"))
  }

  xj <- switch(tolower(substr(axis_title_just, 1, 1)), b=0, l=0, m=0.5, c=0.5, r=1, t=1)
  yj <- switch(tolower(substr(axis_title_just, 2, 2)), b=0, l=0, m=0.5, c=0.5, r=1, t=1)

  tBM <- tBM +
    theme(
      axis.title.x = ggtext::element_markdown(hjust=xj, size = base_size, color = base_color),
      axis.title.y = ggtext::element_markdown(hjust=yj, size = base_size, color = base_color)
    )

  if(ggtext_axis){
    tBM <- tBM +
      theme(
        axis.text.x = ggtext::element_markdown(
          size = axistext_size,
          color = base_color,
          margin = margin(t = 1)
        ),
        axis.text.y = ggtext::element_markdown(
          size = axistext_size,
          color = base_color,
          margin = margin(r = 1)
        )
      )
  } else {
    tBM <- tBM +
      theme(
        axis.text.x = element_text(
          size = axistext_size,
          color = base_color,
          margin = margin(t = 1)
        ),
        axis.text.y = element_text(
          size = axistext_size,
          color = base_color,
          margin = margin(r = 1)
        )
      )
  }

  tBM <- tBM +
    theme(
      plot.title.position = "plot",
      plot.title = ggtext::element_textbox_simple(
        size = title_size,
        hjust = 0,
        color = base_color,
        margin = margin(b = 9)
      )
    )

  tBM <- tBM + theme(
    plot.subtitle = ggtext::element_textbox_simple(
      size = subtitle_size,
      face = "italic",
      hjust = 0,
      color = base_color,
      margin = margin(-6, 0, 9, 0)
    )
  )

  tBM <- tBM + theme(
    plot.caption.position = "plot",
    plot.caption = ggtext::element_textbox_simple(
      hjust = 1, halign = 1,
      color = "#C0BCB5",
      size = axistext_size,
      margin = margin(10, 0, 6, 0)
    )
  )

  if (whitebg) {
    tBM <- tBM + theme(plot.background = element_rect(fill = "white", colour = NA))
  }

  return(tBM)
}
```

## Agenda {.smaller}

::: {.incremental}
1. **Grundlagen: Warum Wiederholungen?**
   *Versuchseinheit und Mindestanforderungen*

2. **Pseudo-Wiederholungen**
   *Messwiederholungen innerhalb einer Versuchseinheit*

3. **Echte Wiederholungen**
   *Randomisation als Grundprinzip*

4. **Die Grauzone**
   *Confounding durch unvollst√§ndige Randomisation*

5. **Multi-Environment Trials**
   *Wiederholungen √ºber Standorte hinweg*

6. **Kernbotschaften & Diskussion**
:::

::: {.notes}
Heute fokussieren wir uns auf die Nuancen des Themas Wiederholungen - Konzepte, die alle kennen, aber wo es wichtige Details gibt.
:::

# 1. Grundlagen {background-color="#00923f"}

## Was ist eine Versuchseinheit? {.smaller}

::: {.callout-tip}
## Hinweis
Die **kleinste Einheit**, der eine Behandlung **unabh√§ngig** zugewiesen werden kann und an der eine Beobachtung gemacht wird.
:::

**Im Feldversuch:**

- In der Regel ist die **Parzelle** unsere Versuchseinheit

## Wieso Wiederholungen? {.smaller}

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2.5

# Minimalbeispiel: Nur 1x A und 1x B
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```
:::

::: {.column width="50%"}
**Ergebnisse:**

| Behandlung | Wert |
|------------|------|
| A          | 10   |
| B          | 8    |

**Was k√∂nnen wir aussagen?**

- ‚úÖ A ist gr√∂√üer als B
- ‚ùå Keine Ahnung √ºber Streuung!
- ‚ùå Keine statistische Auswertung m√∂glich
:::
::::

::: {.notes}
Mit nur einem Wert pro Behandlung k√∂nnen wir nichts machen au√üer sie beschreibend nebeneinander zu stellen. Wir haben null Information √ºber die Variabilit√§t.
:::

## "keine Statistik m√∂glich"? {.smaller}

:::: {.columns}
::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 4
#| fig-height: 2

# Gleicher Plot wie vorher
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, B = 8
:::

::: {.column width="60%"}
::: {.incremental}
- **Varianz** ‚ùå
- **Standardabweichung** ‚ùå
- **Standardfehler** ‚ùå
- **Vertrauensintervalle** ‚ùå
- **t-Test** (oder andere Tests) ‚ùå
- Mittelwert, Minimum, Maximum? ‚Üí Sinnlos bei nur einem Wert ‚ùå
:::
:::
::::

## Mindestanforderungen f√ºr Auswertbarkeit

::: {.callout-important}
## Wichtig
**Streng genommen: Mindestens 2 echte Wiederholungen** pro Behandlung erforderlich!
:::

::: {.incremental}
- Erst ab **n=2** sind all diese Ma√üe √ºberhaupt m√∂glich bzw. sinnvoll
- Mit steigendem n (3, 4, 5, ...) werden die Ergebnisse prinzipiell zuverl√§ssiger und pr√§ziser
:::

## Vergleich: n=1 vs. n=2 {.smaller}

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2

# n=1: Eine Zeile mit A und B
minimal_n1 <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal_n1,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, B = 8
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 3

# n=2: Zwei Zeilen, randomisiert (A,B dann B,A)
minimal_n2 <- data.frame(
  col = c(1, 2, 1, 2),
  row = c(1, 1, 2, 2),
  treatment = c("A", "B", "B", "A")
)

desplot(minimal_n2,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=2",
        show.key = FALSE,
        aspect = 2/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, 11; B = 7, 8
:::
::::

##

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 6

data_observed <- data.frame(
  Behandlung = c("A", "B"),
  Ertrag = c(10, 8),
  Farbe = c("#00923f", "#bce2cc")
)

ggplot(data_observed, aes(x = Behandlung, y = Ertrag)) +
  geom_point(aes(fill = Farbe), size = 4, shape = 21, color = "black", stroke = 1) +
  scale_fill_identity() +
  scale_y_continuous(limits = c(0, 13), breaks = seq(0, 13, 2)) +
  labs(x = "Behandlung", y = "Ertrag [dt/ha]") +
  theme_BioMath(base_family = "Arial")
```

##

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 6

set.seed(123)

# Simulierte Daten
data_simulated <- data.frame(
  Behandlung = rep(c("A", "B"), each = 50),
  Ertrag = c(rnorm(50, mean = 9, sd = 1.5),
             rnorm(50, mean = 9, sd = 1.5))
)

# Beobachtete Daten
data_observed <- data.frame(
  Behandlung = c("A", "B"),
  Ertrag = c(10, 8),
  Farbe = c("#00923f", "#bce2cc")
)

ggplot() +
  geom_point(data = data_simulated,
             aes(x = Behandlung, y = Ertrag),
             color = "gray70", alpha = 0.5, size = 2,
             position = position_jitter(width = 0.1, height = 0)) +
  geom_point(data = data_observed,
             aes(x = Behandlung, y = Ertrag, fill = Farbe),
             size = 4, shape = 21, color = "black", stroke = 1) +
  scale_fill_identity() +
  scale_y_continuous(limits = c(0, 13), breaks = seq(0, 13, 2)) +
  labs(x = "Behandlung", y = "Ertrag [dt/ha]") +
  theme_BioMath(base_family = "Arial")
```

## Warum "echte" Wiederholungen?

Wir haben bis jetzt gesagt:

- n=1 pro Behandlung: **Keine Statistik m√∂glich**
- n‚â•2 pro Behandlung: **Statistik m√∂glich**

. . .

::: {.callout-warning}
## Aber Achtung!
Mehrere Werte zu haben, hei√üt nicht automatisch mehrere **echte Wiederholungen** zu haben!
:::

. . .

‚Üí Was macht den Unterschied zwischen **echten Wiederholungen** und **Pseudo-Wiederholungen**?

# 2. Pseudo-Wiederholungen {background-color="#00923f"}

## Was sind Pseudo-Wiederholungen? {.smaller}

::: {.callout-warning}
## Pseudo-Wiederholungen
Mehrere Messungen, die nicht unabh√§ngig voneinander sind.

Oft: Mehrfache Messungen **innerhalb derselben Versuchseinheit/Parzelle**
:::

Oft synonym verwendet:

- Unechte Wiederholungen
- Messwiederholungen
- Mehrfachmessungen
- Subsamples
- Nested observations
- Pseudoreplikate

## Beispiel: 10 Messungen ‚â† n=10 {.smaller}

:::: {.columns}
::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 4
#| fig-height: 2

# Gleicher Plot: 2 Parzellen
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "2 Parzellen auf dem Feld",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```
:::

::: {.column width="60%"}
**Szenario:**

Wir gehen in dieses Feld und messen in jeder Parzelle **10√ó die Pflanzenh√∂he** (mit Meterstab an verschiedenen Stellen).

**Ergebnis:**

- ‚úÖ 20 Messwerte insgesamt
- ‚ùå **NICHT** n=10 pro Behandlung!
- ‚úÖ Immer noch nur **n=1** pro Behandlung
- ‚úÖ Innerhalb jeder echten Wiederholung je 10 Pseudo-Wiederholungen

::: {.callout-important}
## Wichtig

Mehrfach dieselbe Parzelle beproben ‚â† Mehrere Parzellen haben!
:::
:::
::::

## Intuitive Analogie

**3 Blutabnahmen bei 3 verschiedenen Menschen:**

‚Üí ‚úÖ **3 unabh√§ngige Wiederholungen**

<br>

**3 Blutabnahmen bei 1 Person (an 3 Stellen):**

‚Üí ‚ùå **Nur 1 unabh√§ngige Einheit** (Person)

## Besonders relevant bei On-Farm-Versuchen {.smaller}

**Warum sind Pseudo-Wiederholungen hier besonders h√§ufig?**

::: {.incremental}
1. **Moderne Sensortechnik** erm√∂glicht viele Messungen:
   - GPS-basierte Probenahme; Drohnen mit Multispektralkameras; M√§hdrescher-Sensoren; Bodensensoren:

2. **Sehr gro√üe Parzellen/Streifen:**
   - Hohe Variabilit√§t **innerhalb** einer Parzelle
   - Mehrere Messungen **sinnvoll** zur besseren Charakterisierung

3. **Praktische Einschr√§nkungen:**
   - Nur wenige Wiederholungen realisierbar (Fl√§che, Kosten, Landwirt-Akzeptanz)
   - Viele Messungen innerhalb als **vermeintliche** Kompensation
:::

## Wieso Pseudo-Wiederholungen?

::: {.incremental}
- ‚úÖ **H√∂here Pr√§zision** der Sch√§tzung f√ºr diese Parzelle
- ‚úÖ **R√§umliche Modellierung** m√∂glich (z.B. Geostatistik)
- ‚úÖ **Systematische Trends** innerhalb der Parzelle erfassbar
:::

. . .

::: {.callout-important}
## Aber: Grenzen beachten!

Pseudo-Wiederholungen k√∂nnen echte Wiederholungen NICHT ersetzen.

:::

# Echte Wiederholungen {background-color="#00923f"}

## Was sind echte Wiederholungen?

::: {.callout-warning}
## Echte Wiederholungen / Unabh√§ngige Wiederholungen
Mehrere Messungen, die ~~nicht~~ unabh√§ngig voneinander sind.

Oft: Mehrere Werte von ordentlich randomisierte Parzellen.
:::

## Unabh√§ngigkeit? {.smaller}

::: {.incremental}
- **Ziel:** Mehrere **unabh√§ngige** Werte zur gleichen Behandlung
  - Werte sollen m√∂glichst nicht korreliert/abh√§ngig voneinander sein

- **Mittel:** Randomisation
  - Jede Versuchseinheit (Parzelle) hat die **gleiche Chance**, jede Behandlung zu bekommen
  - Zuf√§llige Zuweisung ist unsere **Versicherung gegen Abh√§ngigkeit**
  - Verhindert systematische r√§umliche Muster
:::

## Randomisiert = Gut

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

set.seed(123)
field_good <- expand.grid(row = 1:4, col = 1:6)
field_good$treatment <- sample(rep(c("A", "B"), each = 12))

desplot(field_good,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Vollst√§ndig randomisiertes Design (CRD)\nBehandlungen sind zuf√§llig √ºber das Feld verteilt",
        show.key = FALSE,
        aspect = 4/6,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 16, hjust = 0.5, family = "Arial"))
```

## Systematisch = Problematisch

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

field_bad <- expand.grid(row = 1:4, col = 1:6)
field_bad$treatment <- rep(c("A", "B"), each = 12)

desplot(field_bad,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Systematisches Design\nBehandlungen sind nicht randomisiert",
        show.key = FALSE,
        aspect = 4/6,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 16, hjust = 0.5, color = "#ad0000", family = "Arial"))
```

## Daten aus Blindversuch

::: {style="font-size: 0.5em"}
**Datenquelle:** Piepho, H.P. & Williams, E.R. (2010). Linear variance models for plant breeding trials. *Plant Breeding*, 129(1), 1‚Äì8.

Alle Parzellen erhielten die **identische Behandlung**, um die nat√ºrliche r√§umliche Variabilit√§t des Feldes zu erfassen.
:::

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 6

library(agridat)
library(desplot)

data(piepho.barley.uniformity)
dat <- piepho.barley.uniformity

desplot(dat,
        yield ~ col * row,
        main = "Ertragsvariabilit√§t trotz identischer Behandlung",
        show.key = TRUE,
        gg = FALSE)
```

## Fazit bis hierhin {.smaller}

:::: {.columns}
::: {.column width="48%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 3

# Systematisches Design - VIELE Parzellen, aber problematisch
field_bad <- expand.grid(row = 1:4, col = 1:6)
field_bad$treatment <- rep(c("A", "B"), each = 12)

desplot(field_bad,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.2,
        main = "‚ùå Systematisch --- 24 Parzellen",
        show.key = FALSE,
        aspect = 4/6,
        gg = TRUE) +
  guides(label = "none") +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 14, hjust = 0.5, color = "#ad0000", family = "Arial"))
```
:::

::: {.column width="4%"}
<!-- Spacer -->
:::

::: {.column width="48%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 3

# n=2 Design - WENIGE Parzellen, aber randomisiert
minimal_n2 <- data.frame(
  col = c(1, 2, 1, 2),
  row = c(1, 1, 2, 2),
  treatment = c("A", "B", "B", "A")
)

desplot(minimal_n2,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "‚úÖ Randomisiert --- 4 Parzellen (n=2)",
        show.key = FALSE,
        aspect = 2/2,
        gg = TRUE) +
  guides(label = "none") +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 14, hjust = 0.5, color = "#00923f", family = "Arial"))
```
:::
::::

**Das rechte Design ist trotz weniger Parzellen/Messwerte dem linken vorzuziehen!**

- Pseudo-Wiederholungen (Messwiederholungen) sind **hilfreich**, aber kein **Ersatz** f√ºr echte Wiederholungen
- **Erst** echte, unabh√§ngige Wiederholungen sicherstellen
- **Dann** k√∂nnen Pseudo-Wiederholungen als wertvolle **Erg√§nzung** dienen

## Okay {.center}

Ja, danke f√ºr den Auffrischer...

...aber das stellt doch auch niemand in Frage?!

::: {style="font-size: 8em; text-align: center;"}
ü•±
:::

# 3. Die (vermeintliche) Grauzone {background-color="#00923f"}

## Typisches Szenario {.smaller}

- Zweifaktorieller Versuch
  - Faktor 1
    - 2 Stufen: A, B
  - Faktor 2
    - 3 Stufen: 1, 2, 3

- Es gibt demnach 6 Kombinationen (A1, A2, A3, B1, B2, B3)
- Mindestanforderung: 2 echte Wiederholungen, also 12 Parzellen
- Tats√§chlich: Ein Faktor schwer zu randomisieren, also Spaltanlage (Split-Plot)

##
```{r}
#| include: false
# Datensatz einmal erstellen
library(desplot)

field_pseudo <- data.frame(
  row = rep(1:3, 6),
  col = rep(1:6, each = 3),
  faktor1 = c(
    "A", "A", "A",
    "A", "A", "A",
    "A", "A", "A",
    "B", "B", "B",
    "B", "B", "B",
    "B", "B", "B"
  ),
  faktor2 = c(
    "1", "2", "1",
    "3", "1", "3",
    "2", "3", "2",
    "2", "3", "3",
    "1", "2", "1",
    "3", "1", "2"
  )
)

field_pseudo$label <- paste0(field_pseudo$faktor1, field_pseudo$faktor2)
```

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

desplot(field_pseudo,
        form = faktor2 ~ col + row,
        text = label,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Zweifaktorieller Versuch: Faktor 1 (A/B) √ó Faktor 2 (1/2/3)\nF√ºllfarbe: Je Stufe Faktor 2",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```

##
```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

desplot(field_pseudo,
        form = label ~ col + row,
        text = label,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Zweifaktorieller Versuch: Faktor 1 (A/B) √ó Faktor 2 (1/2/3)\nF√ºllfarbe: Je Stufenkombination",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```

##
```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

desplot(field_pseudo,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Zweifaktorieller Versuch: Faktor 1 (A/B) √ó Faktor 2 (1/2/3)\nF√ºllfarbe: Je Stufe Faktor 1; Textfarbe: Je Stufe Faktor 2",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```

## Problem: Nur bei einem Faktor echte Wiederholungen {.smaller}

:::: {.columns}
::: {.column width="50%"}

```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2

# Faktor 2 hervorheben (randomisiert)
desplot(field_pseudo,
        form = faktor2 ~ col + row,
        text = label,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Faktor 2 (1/2/3)",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```

**F√ºr Faktor 2 (1/2/3):**

- ‚úÖ Echte Wiederholungen pro Stufe
- ‚úÖ Randomisiert
- ‚úÖ Statistische Auswertung
- keine Pseudowiederholungen

:::

::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2

# Faktor 1 hervorheben (systematisch)
desplot(field_pseudo,
        form = faktor1 ~ col + row,
        text = label,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Faktor 1 (A/B)",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```

**F√ºr Faktor 1 (A/B):**

- ‚ùå n=1 Echte Wiederholung pro Stufe
- ‚ùå Systematisch (2 H√§lften)
- ‚ùå Statistische Auswertung
- je 9 Pseudowiederholungen

:::
::::

```{r}
#| include: false

# L√∂sung 1: Split-Plot Design vorbereiten
set.seed(42)

field_splitplot <- data.frame(
  row = rep(1:3, 6),
  col = rep(1:6, each = 3),
  block = rep(c("Block 1", "Block 2", "Block 3"), each = 6),
  faktor1 = rep(c("B", "A", "A", "B", "A", "B"), each = 3)
)

# Innerhalb jeder Spalte (Main Plot) randomisiere die Sub Plots (1, 2, 3)
faktor2_randomized <- c()
for(i in 1:6) {
  faktor2_randomized <- c(faktor2_randomized, sample(c("1", "2", "3")))
}

field_splitplot$faktor2 <- faktor2_randomized
field_splitplot$label <- paste0(field_splitplot$faktor1, field_splitplot$faktor2)

# L√∂sung 2: Dupliziertes Design mit A/B Tausch vorbereiten
field_solution2 <- data.frame(
  col = rep(1:6, each = 6),
  row = rep(1:6, 6)
)

field_solution2$faktor1 <- NA

for(i in 1:nrow(field_solution2)) {
  current_col <- field_solution2$col[i]
  current_row <- field_solution2$row[i]

  if(current_row <= 3) {
    if(current_col <= 3) {
      field_solution2$faktor1[i] <- "A"
    } else {
      field_solution2$faktor1[i] <- "B"
    }
  } else {
    if(current_col <= 3) {
      field_solution2$faktor1[i] <- "B"
    } else {
      field_solution2$faktor1[i] <- "A"
    }
  }
}

field_solution2$faktor2 <- rep(field_pseudo$faktor2, 2)
field_solution2$label <- paste0(field_solution2$faktor1, field_solution2$faktor2)
```

## L√∂sung 1 {.smaller}

:::: {.columns}
::: {.column width="50%"}
**Problemfall:**
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

# Problematisches Design zeigen
desplot(field_pseudo,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = NULL,
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```
:::

::: {.column width="50%"}
**L√∂sungsvorschlag 1:**
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

# Split-Plot Design
desplot(field_splitplot,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = NULL,
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```
:::
::::

## L√∂sung 2 {.smaller}

:::: {.columns}
::: {.column width="50%"}
**Problemfall:**
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

# Problematisches Design zeigen
desplot(field_pseudo,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = NULL,
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```
:::

::: {.column width="50%"}
**L√∂sungsvorschlag 2:**
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 6

# Dupliziertes Design mit A/B Tausch
desplot(field_solution2,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = NULL,
        show.key = FALSE,
        aspect = 6/6,
        gg = FALSE)
```
:::
::::

# 4. Versuchsserien {background-color="#00923f"}

## Mehrere Standorte {.smaller}

**Wiederholen kann man auch √ºber verschiedene Orte:**

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

# Nur obere H√§lfte zeigen
field_upper <- field_solution2[field_solution2$row <= 3, ]
desplot(field_upper,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Standort 1",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 4

# Nur untere H√§lfte zeigen
field_lower <- field_solution2[field_solution2$row > 3, ]
field_lower$row <- field_lower$row - 3  # Zeilen neu nummerieren
desplot(field_lower,
        form = faktor1 ~ col + row,
        text = label,
        col = faktor2,
        out1 = col, out1.gpar = list(col = "grey", lty = 1),
        out2 = row, out2.gpar = list(col = "grey", lty = 1),
        cex = 1.2,
        main = "Standort 2",
        show.key = FALSE,
        aspect = 3/6,
        gg = FALSE)
```
:::
::::

**Das Prinzip bleibt gleich:** Wiederholung auf der Ebene "Standort"

## Oder noch simpler: {.smaller}

**Das funktioniert auch mit dem einfachsten Design:**

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2.5

# Minimalbeispiel Standort 1: A, B
site1_minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(site1_minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Standort 1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE)
```
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2.5

# Minimalbeispiel Standort 2: B, A (getauscht)
site2_minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("B", "A")
)

desplot(site2_minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Standort 2",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE)
```
:::
::::

**Pro Standort:** Keine statistische Auswertung m√∂glich ‚ùå

**√úber beide Standorte hinweg:** n=2 f√ºr jede Behandlung ‚Üí Statistische Auswertung m√∂glich ‚úÖ Ein Ort entspricht einem vollst√§ndigen Block

::: {.callout-note}
## Aber
**Behandlung √ó Umwelt Interaktion:** Behandlungen k√∂nnen je nach Standort unterschiedlich wirken!

Diese Annahme treffen wir f√ºr Bl√∂cke am selben Ort nicht.
:::

## TODO

Kernbotschaften / Abschlussfolie
