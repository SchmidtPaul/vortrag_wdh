---
title: "Wiederholungen in landwirtschaftlichen Feldversuchen"
subtitle: "Nuancen, Probleme und häufige Fallstricke"
author: "Dr. Paul Schmidt"
date: "28. November 2024"
format:
  revealjs:
    theme: default
    css: custom.css
    slide-number: true
    chalkboard: true
    preview-links: auto
    footer: "Workshop On-Farm-Experimente | 28.11.2024"
    transition: slide
    background-transition: fade
---

```{r setup}
#| include: false

library(ggplot2)
library(desplot)

# Setze globale Farbpalette für alle ggplot2/desplot Grafiken
options(ggplot2.discrete.fill = c("#00923f", "#bce2cc", "#4758ab", "#ad0000", "#cba135"))
options(ggplot2.discrete.colour = c("#00923f", "#bce2cc", "#4758ab", "#ad0000", "#cba135"))
```

## Agenda {.smaller}

::: {.incremental}
1. **Grundlagen: Warum Wiederholungen?**
   *Versuchseinheit und Mindestanforderungen*

2. **Pseudo-Wiederholungen**
   *Messwiederholungen innerhalb einer Versuchseinheit*

3. **Echte Wiederholungen**
   *Randomisation als Grundprinzip*

4. **Die Grauzone**
   *Confounding durch unvollständige Randomisation*

5. **Multi-Environment Trials**
   *Wiederholungen über Standorte hinweg*

6. **Kernbotschaften & Diskussion**
:::

::: {.notes}
Heute fokussieren wir uns auf die Nuancen des Themas Wiederholungen - Konzepte, die alle kennen, aber wo es wichtige Details gibt.
:::

# 1. Grundlagen {background-color="#495057"}

## Was ist eine Versuchseinheit? {.smaller}

::: {.callout-tip}
## Definition: Versuchseinheit (Experimental Unit)
Die **kleinste Einheit**, der eine Behandlung **unabhängig** zugewiesen werden kann und an der eine Beobachtung gemacht wird.
:::

**Im Feldversuch:**

- In der Regel ist die **Parzelle** unsere Versuchseinheit
- Manchmal kann es aber auch anders sein (z.B. ganze Felder, Pflanzreihen, etc.)

## Warum brauchen wir überhaupt Wiederholungen? {.smaller}

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2.5

# Minimalbeispiel: Nur 1x A und 1x B
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```
:::

::: {.column width="50%"}
**Ergebnisse:**

| Behandlung | Wert |
|------------|------|
| A          | 10   |
| B          | 8    |

**Was können wir aussagen?**

- A ist größer als B ✓
- Aber: **Keine Ahnung über Streuung!** ✗
- → Keine statistische Auswertung möglich
:::
::::

::: {.notes}
Mit nur einem Wert pro Behandlung können wir nichts machen außer sie beschreibend nebeneinander zu stellen. Wir haben null Information über die Variabilität.
:::

## Was bedeutet "keine Statistik möglich"? {.smaller}

:::: {.columns}
::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 4
#| fig-height: 2

# Gleicher Plot wie vorher
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, B = 8
:::

::: {.column width="60%"}
**Welche statistischen Maße sind NICHT möglich?**

::: {.incremental}
- **Varianz** ✗
- **Standardabweichung** ✗
- **Standardfehler** ✗
- **Konfidenzintervalle** ✗
- **t-Test** (oder andere Tests) ✗
- Mittelwert, Minimum, Maximum? → Sinnlos bei nur einem Wert

::: {.callout-warning}
Null Information über Variabilität!
:::
:::
:::
::::

## Mindestanforderungen für Auswertbarkeit

::: {.callout-important}
## Absolutes Minimum
**Streng genommen: Mindestens 2 echte Wiederholungen** pro Behandlung erforderlich!
:::

::: {.incremental}
- Erst ab **n=2** sind all diese Maße überhaupt möglich bzw. sinnvoll
- Mit steigendem n (3, 4, 5, ...) werden die Ergebnisse prinzipiell zuverlässiger und präziser
:::

## Vergleich: n=1 vs. n=2 {.smaller}

:::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 2

# n=1: Eine Zeile mit A und B
minimal_n1 <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal_n1,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=1",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, B = 8
:::

::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 3

# n=2: Zwei Zeilen, randomisiert (A,B dann B,A)
minimal_n2 <- data.frame(
  col = c(1, 2, 1, 2),
  row = c(1, 1, 2, 2),
  treatment = c("A", "B", "B", "A")
)

desplot(minimal_n2,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Versuch mit n=2",
        show.key = FALSE,
        aspect = 2/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```

**Werte:** A = 10, 11; B = 7, 8
:::
::::

## Warum "echte" Wiederholungen?

Wir haben bis jetzt gesagt:

- n=1 pro Behandlung: **Keine Statistik möglich**
- n≥2 pro Behandlung: **Statistik möglich**

. . .

::: {.callout-warning}
## Aber Achtung!
Mehrere Werte zu haben, heißt nicht automatisch mehrere **echte Wiederholungen** zu haben!
:::

. . .

→ Was macht den Unterschied zwischen **echten** und **unechten** Wiederholungen?

# 2. Pseudo-Wiederholungen {background-color="#495057"}

## Was sind Pseudo-Wiederholungen?

::: {.callout-warning}
## Pseudo-Wiederholungen (Messwiederholungen)
Mehrfache Messungen **innerhalb derselben Versuchseinheit** (z.B. Parzelle)
:::

<br>

**Das Problem:**

Messungen innerhalb derselben Parzelle sind **nicht unabhängig** voneinander!

## Beispiel: 10 Messungen ≠ n=10 {.smaller}

:::: {.columns}
::: {.column width="40%"}
```{r}
#| echo: false
#| fig-width: 4
#| fig-height: 2

# Gleicher Plot: 2 Parzellen
minimal <- data.frame(
  col = c(1, 2),
  row = c(1, 1),
  treatment = c("A", "B")
)

desplot(minimal,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "2 Parzellen auf dem Feld",
        show.key = FALSE,
        aspect = 1/2,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 12, hjust = 0.5, family = "Arial"))
```
:::

::: {.column width="60%"}
**Szenario:**

Wir gehen in dieses Feld und messen in jeder Parzelle **10× die Pflanzenhöhe** (mit Meterstab an verschiedenen Stellen).

**Ergebnis:**

- ✓ 20 Messwerte insgesamt
- ✗ **NICHT** n=10 pro Behandlung!
- ✓ Immer noch nur **n=1** pro Behandlung

. . .

::: {.callout-important}
Mehrfach dieselbe Parzelle beproben ≠ Mehrere Parzellen haben!
:::
:::
::::

## Intuitive Analogie

**3 Blutabnahmen bei 3 verschiedenen Menschen:**

→ ✓ **3 unabhängige Wiederholungen**

<br>

**3 Blutabnahmen bei 1 Person (an 3 Stellen):**

→ ✗ **Nur 1 unabhängige Einheit** (Person)

<br>

::: {.fragment}
**Jeder versteht intuitiv: Das ist nicht dasselbe!**
:::

## Besonders relevant bei On-Farm-Versuchen {.smaller}

**Moderne Sensortechnik ermöglicht viele Messungen:**

::: {.incremental}
- **Drohnen** mit Multispektralkameras: Tausende Pixel pro Parzelle
- **Mähdrescher-Sensoren**: Ertragsmessung alle paar Meter
- **Bodensensoren**: Kontinuierliche Messungen an festen Punkten
- **GPS-basierte Probenahme**: Viele Messpunkte pro Großparzelle
:::

. . .

::: {.callout-warning}
## Häufiger Trugschluss
*"Ich habe 1000 Messpunkte!"*

→ **ABER:** Wenn alle in derselben räumlichen Einheit liegen = begrenzte statistische Unabhängigkeit
:::

## Kernaussage zu Pseudo-Wiederholungen

::: {.callout-note icon=false}
## ⭐ Take-Home Message
**Messwiederholungen sind keine echten Wiederholungen.**

- Sie erhöhen die Präzision der Messung
- Sie reduzieren Messfehler
- **Aber:** Sie erhöhen NICHT die Anzahl unabhängiger Wiederholungen
- Bei der Analyse muss die hierarchische Struktur berücksichtigt werden
:::

# Echte/Unabhängige Wiederholungen {background-color="#495057"}

## Was macht eine echte Wiederholung aus?

Nachdem wir nun verstanden haben, was **Pseudo-Wiederholungen** sind, schauen wir uns an, was eine **echte Wiederholung** ausmacht.

## Randomisation ist entscheidend! {.smaller}

::: {.incremental}
- Parzellen müssen **zufällig verteilt** über das Feld liegen
- Dürfen auch nebeneinander liegen - **wenn die Randomisation dies ergab**
- **NICHT** systematisch direkt nebeneinander angeordnet
- Vollständig zufällige Zuweisung:
  - Welche Parzelle?
  - Welche Behandlung?
  - Welche Wiederholung?
:::

## Visualisierung: Gutes Design

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

set.seed(123)
field_good <- expand.grid(row = 1:4, col = 1:6)
field_good$treatment <- sample(rep(c("A", "B"), each = 12))

desplot(field_good,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Vollständig randomisiertes Design (CRD)\nBehandlungen sind zufällig über das Feld verteilt",
        show.key = TRUE,
        aspect = 4/6,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 16, hjust = 0.5, family = "Arial"),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 12, family = "Arial"))
```

::: {.fragment}
✓ Räumlich unabhängig = Statistisch unabhängig
:::

## Visualisierung: Schlechtes Design

```{r}
#| echo: false
#| fig-width: 10
#| fig-height: 5

field_bad <- expand.grid(row = 1:4, col = 1:6)
field_bad$treatment <- rep(c("A", "B"), each = 12)

desplot(field_bad,
        form = treatment ~ col + row,
        text = treatment,
        cex = 1.5,
        main = "Systematisches Design\nBehandlungen sind nicht randomisiert - PROBLEMATISCH!",
        show.key = TRUE,
        aspect = 4/6,
        gg = TRUE) +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 16, hjust = 0.5, color = "#ad0000", family = "Arial"),
        legend.position = "bottom",
        legend.title = element_blank(),
        legend.text = element_text(size = 12, family = "Arial"))
```

::: {.fragment}
✗ Systematische Anordnung = Confounding mit räumlichen Effekten
:::

## Kernaussage

::: {.callout-note icon=false}
## ⭐ Take-Home Message
**Echte, unabhängige Wiederholungen** sind die Grundlage für statistische Auswertungen.

Sie erfordern:

- ✓ Randomisation
- ✓ Räumliche Unabhängigkeit
- ✓ Statistische Unabhängigkeit
:::

# 3. Die Grauzone {background-color="#495057"}

## Das Problem: Pseudo-Split-Plot

::: {.callout-warning}
## Häufig in der Praxis!
Unvollständige oder systematische Randomisation führt zu versteckten Pseudo-Wiederholungen
:::

<br>

**Typisches Szenario:**

- Zweifaktorieller Versuch: Faktor A × Faktor B
- Versuch, ein Split-Plot-Design anzulegen
- **Aber:** Faktor A ist NICHT randomisiert, sondern systematisch angeordnet

## Konkretes Beispiel: Nord vs. Süd {.smaller}

::: {.columns}
::: {.column width="50%"}
```{r}
#| echo: false
#| fig-width: 5
#| fig-height: 6

field_split <- data.frame(
  row = rep(1:8, each = 4),
  col = rep(1:4, 8),
  A = rep(c("A1", "A2"), each = 16),
  B = rep(c("B1", "B2"), 16)
)

# Hier brauchen wir spezielle Farben (Grün vs. Rot) um das Problem zu visualisieren
desplot(field_split,
        form = A ~ col + row,
        text = B,
        col.regions = c("A1" = "#00923f", "A2" = "#ad0000"),
        cex = 1.2,
        main = "Problematisches Layout",
        show.key = FALSE,
        aspect = 8/4,
        gg = TRUE) +
  annotate("text", x = 2.5, y = 7, label = "NÖRDLICHE HÄLFTE (A1)",
           size = 4.5, fontface = "bold", color = "white") +
  annotate("text", x = 2.5, y = 2, label = "SÜDLICHE HÄLFTE (A2)",
           size = 4.5, fontface = "bold", color = "white") +
  theme(text = element_text(family = "Arial"),
        plot.title = element_text(size = 14, hjust = 0.5, color = "#ad0000", family = "Arial"))
```
:::

::: {.column width="50%"}
**Was wir sehen:**

- Faktor B (B1, B2) ist randomisiert ✓
- Faktor A ist systematisch (Nord vs. Süd) ✗

<br>

**Das Problem:**

- Gesamte Nordhälfte = A1
- Gesamte Südhälfte = A2
- → **n=1** pro Stufe von Faktor A!
:::
:::
:::

<br>

. . .

::: {.callout-important}
**Systematische räumliche Struktur = Fehlende Unabhängigkeit**

Das gilt auf **allen Ebenen** des Versuchsdesigns!
:::

## Kernaussage

::: {.callout-note icon=false}
## ⭐ Take-Home Message
**Vorsicht vor der Grauzone!**

- Systematische Anordnung = versteckte Pseudo-Wiederholung
- Häufiger Fehler bei On-Farm-Versuchen
- Große Parzellenzahl ≠ Viele unabhängige Wiederholungen

**Entscheidend ist:**

- NICHT die Anzahl der Parzellen
- Sondern die **räumliche Unabhängigkeit** der Behandlungen
:::

# 4. Multi-Environment Trials {background-color="#495057"}

## Wiederholungen über Standorte

**Szenario:**

- Einzelner Standort: Keine (oder nur wenige) Wiederholungen möglich
- **Lösung:** Gleiche Behandlungen an mehreren Standorten

. . .

## Warum ist das problematisch? {.smaller}

::: {.incremental}
1. **Alle A1-Parzellen** liegen in derselben Feldhälfte (Nord)
2. **Alle A2-Parzellen** liegen in derselben Feldhälfte (Süd)
3. Jeglicher Nord-Süd-Unterschied (Boden, Wasser, Mikroklima) ist **vollständig konfundiert** mit Faktor A
4. Wir können **nicht unterscheiden**:
   - Ist der Effekt aufgrund von Behandlung A?
   - Oder aufgrund der Lage (Nord vs. Süd)?
:::

. . .

::: {.callout-warning}
## Häufiger Trugschluss
*"Ich habe doch viele Parzellen!"*
*"Ich habe doch A1×B1 mehrfach auf dem Feld!"*

→ **ABER:** Alle Instanzen von A1 teilen dieselbe räumliche Einheit = keine Unabhängigkeit
:::

## Analogie zu Pseudo-Wiederholungen

::: {.columns}
::: {.column width="50%"}
**Pseudo-Wiederholungen:**

- 1 Parzelle
- Mehrfache Messungen darin
- = Keine Unabhängigkeit
:::

::: {.column width="50%"}
**Pseudo-Split-Plot:**

- 1 Feldhälfte
- Mehrfache Parzellen darin
- = Keine Unabhängigkeit für Faktor A
:::
:::

<br>

. . .

::: {.callout-important}
**Systematische räumliche Struktur = Fehlende Unabhängigkeit**

Das gilt auf **allen Ebenen** des Versuchsdesigns!
:::

## Kernaussage

::: {.callout-note icon=false}
## ⭐ Take-Home Message
**Vorsicht vor der Grauzone!**

- Systematische Anordnung = versteckte Pseudo-Wiederholung
- Häufiger Fehler bei On-Farm-Versuchen
- Große Parzellenzahl ≠ Viele unabhängige Wiederholungen

**Entscheidend ist:**

- NICHT die Anzahl der Parzellen
- Sondern die **räumliche Unabhängigkeit** der Behandlungen
:::

# 4. Multi-Environment Trials {background-color="#495057"}

## Wiederholungen über Standorte

**Szenario:**

- Einzelner Standort: Keine (oder nur wenige) Wiederholungen möglich
- **Lösung:** Gleiche Behandlungen an mehreren Standorten

. . .

::: {.callout-tip}
## Vorteil
Erst durch mehrere Standorte wird die Auswertung möglich und robuster!

→ "Standort" wird zu einer weiteren Ebene im Design
:::

## Statistische Überlegungen {.smaller}

**Wie behandeln wir "Standort" in der Analyse?**

::: {.incremental}
1. **Als Block (Fixed Effect)?**
   - Wenn uns die spezifischen Standorte interessieren
   - Wenn wir Aussagen über einzelne Standorte treffen wollen

2. **Als Random Effect?**
   - Wenn Standorte eine Stichprobe aus einer größeren Population sind
   - Wenn wir über die getesteten Standorte hinaus generalisieren wollen
   - → Häufigerer Ansatz bei Multi-Environment Trials
:::

. . .

::: {.callout-note}
## Wichtig zu beachten
**Genotyp × Environment Interaktion:** Behandlungen können je nach Standort unterschiedlich wirken!
:::

# Zusammenfassung {background-color="#495057"}

## Kernbotschaften {.smaller}

::: {.incremental}
1. **Echte Wiederholungen brauchen Randomisation**
   - Räumlich unabhängig = Statistisch unabhängig
   - Nicht die Anzahl zählt, sondern die Unabhängigkeit

2. **Messwiederholungen sind keine echten Wiederholungen**
   - Erhöhen Präzision, aber nicht Unabhängigkeit
   - Hierarchische Struktur in der Analyse berücksichtigen

3. **Vorsicht vor der Grauzone!**
   - Systematische Anordnung = Confounding
   - Häufiger Fehler bei On-Farm-Versuchen
   - Große Parzellenzahl ≠ Viele unabhängige Wiederholungen

4. **Die Randomisation ist entscheidend**
   - Auf allen Ebenen des Designs
   - Räumliche Unabhängigkeit der Behandlungen sicherstellen
:::

## Offene Fragen für die Diskussion

::: {.incremental}
- Wie geht man in der Praxis mit halb-systematischen Designs um?
- Wann sind Kompromisse vertretbar?
- Wie kommuniziert man diese Konzepte an Landwirte?
- Welche statistischen Ansätze gibt es für suboptimale Designs?
- Wie viele Wiederholungen sind "genug"?
:::

## Vielen Dank! {.center}

<br>

### Fragen & Diskussion

<br>

::: {.callout-tip icon=false}
## Kontakt
Dr. Paul Schmidt
Biostatistiker

Workshop On-Farm-Experimente
28. November 2024
:::

<br>

*Präsentation erstellt mit Quarto & Claude Code*
